

<% if current_user.id == @calculation.user_id || current_user.id==2  %>
<%- model_class = Calculation -%>
<div class="bs-docs-example">
            <div class="navbar">
              <div class="navbar-inner">
                <a class="brand" href="#">Расчет тягово-динамических характеристик автомобиля</a>
                <ul class="nav">
                  <li class="active"><a href="/">На главную</a></li>
                   <li><%= link_to "Создание расчета", new_calculation_path%></li>
                  <li><%= link_to "Список пользователей",users_index_path%></li>
                   <li><%= link_to "Список расчетов", calculations_path%></li>
                  <li  class="dropdown">
                   <button class="btn btn-small dropdown-toggle" data-toggle="dropdown">Доплнительно <span class="caret"></span></button>
                     <ul class="dropdown-menu">
                      <li><a href="#">Информация(скоро)</a></li>
                      <li><a href="#">Литература(скоро)</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </div>

<div class="page-header"align="center">
  <h1><%=t '.title', :default => @calculation.name  %></h1>
</div>
<div class="accordion-group"align="center">
    <div class="accordion-heading"align="center">
      <a align="center" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree">
       Исходные данные
      </a>
    </div>
    <div id="collapseThree" class="accordion-body collapse"align="center">
      <div class="accordion-inner"align="center">
<div class="dl-horizontal"align="center">

  
  <div><strong><%= "Полная масса автомобиля" %> : </strong> <%= @calculation.mass_avto %></div>
  
  <div><strong><%= "Колея автомобиля" %> : </strong> <%= @calculation.col_avto %></div>
 
  <div><strong><%= "Высота автомобиля"%> : </strong><%= @calculation.height_avto %></div>

  <div><strong><%= "Коэфициент аэродинамического сопротивления" %> : </strong><%= @calculation.k_air_sopr %></div>

  <div><strong><%=  "Ширина профиля шины" %> : </strong><%= @calculation.shin_wide %></div>
  
  <div><strong><%= "Высота профиля шины" %> : </strong><%= @calculation.shin_height %></div>
  
  <div><strong><%= "Посадочный диаметр" %> : </strong><%= @calculation.sit_diam %></div>
  
  <div><strong><%="Максимальная мощность двигателя" %> : </strong><%= @calculation.n_e_max %></div>

  <div><strong><%= "Максимальный момент двигателя" %> : </strong><%= @calculation.m_e_max %></div>
 
  <div><strong><%= "Обороты двигателя при максимальной мощности" %> : </strong><%= @calculation.n_N %></div>
  
  <div><strong><%= "Обороты двигателя при максимальном моменте" %> : </strong><%= @calculation.n_m %></div>
  
  <div><strong><%= "Минимальные обороты двигателя" %> : </strong><%= @calculation.n_min %></div>
 
  <div><strong><%= "Максимальные обороты двигателя" %> : </strong><%= @calculation.n_k %></div>
 
  <div><strong><%= "Потери на навесное оборудование" %> : </strong><%= @calculation.nu_b %></div>
  
  <div><strong><%= "К.П.Д. трансмиссии" %> : </strong><%= @calculation.nu_t %></div>
 
  <div><strong><%= "Передадочное число главной передачи" %> : </strong><%= @calculation.uo %></div>

  <div><strong><%= "Количество передач" %> : </strong><%= @calculation.n %></div>

  <div><strong><%= "Передадочное число 1 передачи" %> : </strong><%= @calculation.uk1 %></div>

  <div><strong><%= "Передадочное число 2 передачи"%> : </strong><%= @calculation.uk2 %></div>

  <div><strong><%= "Передадочное число 3 передачи"%> : </strong><%= @calculation.uk3 %></div>

  <div><strong><%=  "Передадочное число 4 передачи"%> : </strong><%= @calculation.uk4 %></div>

  <div><strong><%= "Передадочное число 5 передачи" %> : </strong><%= @calculation.uk5 %></div>
 
  <div><strong><%= "Передадочное число 6 передачи" %> : </strong><%= @calculation.uk6 %></div>
  
  <div><strong><%= "Передадочное число 7 передачи" %> : </strong><%= @calculation.uk7 %></div>

  <div><strong><%= "Передадочное число 8 передачи" %> : </strong><%= @calculation.uk8 %></div>

  <div><strong><%= "Передадочное число 9 передачи" %> : </strong><%= @calculation.uk9 %></div>

  <div><strong><%= "Передадочное число 10 передачи" %> : </strong><%= @calculation.uk10 %></div>

  <div><strong><%= "Передадочное число 11 передачи" %> : </strong><%= @calculation.uk11 %></div>

  <div><strong><%= "Передадочное число 12 передачи" %> : </strong><%= @calculation.uk12 %></div>

  <div><strong><%=  "Передадочное число 13 передачи"%> : </strong><%= @calculation.uk13 %></div>

  <div><strong><%=  "Передадочное число 14 передачи"%> : </strong><%= @calculation.uk14 %></div>
 
  <div><strong><%= "Передадочное число 15 передачи" %> : </strong><%= @calculation.uk15 %></div>

  <div><strong><%= "Коэфициент сопротивления дороги" %> : </strong><%= @calculation.kroad %></div>

</div>
</div>
</div>
</div>
<%if  !@calculation.n_e_max.blank? || !@calculation.n_N.blank? || !@calculation.n_e_max.blank?%>
 <h2 align="center"><%=t '.title', :default => "Расчеты:" %></h2>

</br>

  <h2 align="center"><%=t '.title', :default => "Внешняя скоростная характеристика автомобиля" %></h2>

  <br/>
<div class="dl-horizontal"align="center">

  





<div class="accordion-group"align="center">
    <div class="accordion-heading"align="center">
      <a align="center"class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse3">
        Расчет некоторых параметров
      </a>
    </div>
    <div id="collapse3" class="accordion-body collapse"align="center">
        <div class="accordion-inner"align="center">
           <table class="table table-striped"align="center">
                <thead>
                  <tr>
                    <th><%= "Параметр"%></th>
                    <th><%= "Значение" %></th>
                  </tr>
                </thead>
                <tbody>
                        <%if !@calculation.m_e_max.blank?%>
                                <%mn=@calculation.n_e_max*1000.0/(@calculation.n_N*2*Math::PI/60.0)  %>
                                <% x=(@calculation.n_m+0.0)/@calculation.n_N %>
                                <% k=@calculation.m_e_max/mn %>
                                <% c = (1-k)/(2*x-(x*x)-1)   %>
                                
                        <tr>
                            <td> <%= "Ширина профиля шины Bsh" %> </td>
                            <td> <%= fa=@calculation.col_avto*@calculation.height_avto  %><%=" м"%></td>
                        </tr>
                        <tr>
                            <td> <%= "Площадь лобового сечения транспортного средства (Fa)" %> </td>
                            <td> <%= @calculation.shin_wide   %><%=" мм"%></td>
                        </tr>
                        <tr>
                            <td> <%= "Высота профиля шины (Hsh)" %> </td>
                            <td> <%= h_sh=@calculation.shin_height*@calculation.shin_wide/100.0   %><%=" мм"%></td>
                        </tr>
                         <tr>
                            <td> <%= "Плотность воздуха (" %>&rho;) </td>
                            <td> <%=rho=1.225%><%=" кг/м"%><sup>3</sup></td>
                        </tr>    
                        <tr>
                            <td> <%= "Коэфициент сопротивления воздуха (k" %><sub>B</sub>)  </td>
                            <td> <%= kB = @calculation.k_air_sopr*1.225/2   %></td>
                        </tr>   
                        <tr>
                            <td> <%= "Посадочный диаметр (d)" %> </td>
                            <td> <%= @calculation.sit_diam  %>&uml;</td>
                        </tr>   
                        <tr>
                            <td> <%= "Наружный диаметр колеса (D)" %> </td>
                            <td><%= n_D= 25.4*@calculation.sit_diam+2*h_sh %><%=" мм"%>  </td>
                        </tr>   
                        <tr>
                            <td> <%= "Статический радиус (r" %><sub>c</sub> ) </td>
                            <td><%= rc=0.5*n_D  %><%=" мм"%>  </td>
                        </tr>  
                        <tr>
                            <td> <%= "Нормальный прогиб шины (h" %><sub>z</sub> ) </td>
                            <td><%= hz=0.12*h_sh   %><%=" мм"%>  </td>
                        </tr>     
                        <tr>
                            <td> <%= "Динамический радиус колеса (r" %><sub>d</sub> ) </td>
                            <td><%= rd=(rc-hz)/1000   %><%=" м"%> </td>
                        </tr>  
                        <tr>
                            <td> <%= "Кинематический радиус (r" %><sub>k</sub> ) </td>
                            <td><%= rk=(3*rc/(rc/(rc-hz)+2))/1000   %><%=" м"%> </td>
                        </tr> 
                        <tr>
                            <td> <%= "Минимальные-максимальные обороты двигателя (n" %><sub>e_min</sub>-<%= " n" %><sub>e_max</sub> ) </td>
                            <td><%= @calculation.n_min   %>-<%=@calculation.n_k%><%=" об/мин"%></td>
                        </tr>       
                        <tr>
                            <td> <%= "Коэфициент " %>&phi; </td>
                            <td><%= phi=0.8   %></td>
                        </tr> 
                        <tr>
                            <td> <%= "Коэфициент k" %><sub>SC</sub></td>
                            <td><%= ksc=1   %></td>
                        </tr> 
                                          
                </tbody>
          </table>
        </div>
    </div>       

 <h2 align="center"><%=t '.title', :default => "Внешняя скоростная характеристика автомобиля" %></h2>
 <div class="accordion-group"align="center">
    <div class="accordion-heading"align="center">
      <a align="center"class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse4">
        Расчет внешних скоростных характеристик автомобиля
      </a>
    </div>
    <div id="collapse4" class="accordion-body collapse"align="center">
        <div class="accordion-inner"align="center">
           <table class="table table-striped"align="center">
                <thead>
                  <tr>
                    <th><%= "Параметр"%></th>
                    <th><%= "Значение" %></th>
                  </tr>
                </thead>
                <tbody>
                        <tr>
                            <td> <%= "Момент максимальной мощности (Mn)" %> </td>
                            <td> <%=mn  %> Н*м</td>
                        </tr>
                        <tr>
                            <td> <%= "Коэфициент а" %> </td>
                            <td><%= a = k-c*x*x   %></td>
                        </tr>       
                        <tr>
                            <td> <%= "Коэфициент b" %>  </td>
                            <td><%= b = 2*c*x   %></td>
                        </tr>   
                        <tr>
                            <td> <%= "Коэфициент с" %>  </td>
                            <td><%= c   %></td>
                        </tr>  
          </tbody>
          </table>
        </div>
    </div>   

 



</div>
 <br/>
 <%ne = Array.new%>
 <%pNe = Array.new%>
 <%nE = Array.new%>
 <%pMe = Array.new%>
 <%me = Array.new%>
 <%pk_ne = Array.new%>
 <%va_ne = Array.new%>
 <%pk_n = Array.new%>
 <%va_n = Array.new%>
  <%uk = Array.new%>
  <%uk[0]=@calculation.uo%>
  <%uk[1]=@calculation.uk1%>
  <%uk[2]=@calculation.uk2%>
  <%uk[3]=@calculation.uk3%>
  <%uk[4]=@calculation.uk4%>
  <%uk[5]=@calculation.uk5%>
  <%uk[6]=@calculation.uk6%>
  <%uk[7]=@calculation.uk7%>
  <%uk[8]=@calculation.uk8%>
  <%uk[9]=@calculation.uk9%>
  <%uk[10]=@calculation.uk10%>
  <%uk[11]=@calculation.uk11%>
  <%uk[12]=@calculation.uk12%>
  <%uk[13]=@calculation.uk13%>
  <%uk[14]=@calculation.uk14%>
  <%uk[15]=@calculation.uk15%>
 <head>
  <meta charset="utf-8">



    <div class="accordion-heading"align="center">
      <a align="center"class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
        Таблица внешней скоростной характеристики двигателя
      </a>
    </div>
    <div id="collapseTwo" class="accordion-body collapse"align="center">
      <div class="accordion-inner"align="center">
 <table class="table table-striped"align="center">
  <thead>
    <tr>
      <th><%= "№" %></th>

       <th><%= "ne" %></th>

      <th><%= "N'e" %></th>
      
      <th><%= "Ne" %></th>

      <th><%= "M'e" %></th>

      <th><%= "Me" %></th>
    </tr>
  </thead>
  <% for i in 0..70 %>
    <tbody>
       <tr>
        <td> <%=i%></td>
   <td><%=ne[i]=((@calculation.n_min)+i*(((1.05*@calculation.n_k-@calculation.n_min))/70))%></td>
    <%x=(ne[i]/(1.05*@calculation.n_k))%>
   <td><%=pNe[i]=@calculation.n_e_max*(1*x+1*x*x-1*x*x*x)%></td>
   <td><%=nE[i]=pNe[i]*@calculation.nu_b%></td>
   <td><%=pMe[i]=pNe[i]*9550/(ne[i])%></td>
   <td><%=me[i]=nE[i]*9550/(ne[i])%></td>
 

    </tr>

    <%end%>
   </tbody>
 </table>
    </div>
  </div>

  <br/>
<%g = Gruff::Line.new('800x700')%>
<%g.title = "Внешняя скоростная характеристика двигателя" %>
<%g.title_font_size=25%>
 <%g.minimum_value = 0%>
 <%   g.maximum_value = 300%>
<%g.data("N'e(ne)", pNe)%>
<%g.data("Ne(ne)", nE)%>
<%g.data("M'e(ne)", pMe)%>
<%g.data("Me(ne)", me)%>
<%g.labels = {0 => "0"  , 20 => "#{(ne[20]/1000).to_i}*10^3"  , 40 => "#{(ne[40]/1000).to_i}*10^3",  60 => "#{(ne[60]/1000).to_i}*10^3"  , 80 => "8*10^3"  }%>
<%g.write('public/images/int_vel_ch_eng.png')%>
<br/>
    <button type="button" class="btn btn-danger" data-toggle="collapse" data-target="#demo2">
    Скрыть/показать график
    </button>
     
    <div align="center"id="demo2" class="collapse in"><br/> <img alt="Sample App" class="round" src="/images/int_vel_ch_eng.png" /></div>


<br/> 
<br/>

  <h1><%=t '.title', :default => "Силовой баланс автомобиля " %></h1>

 
              <div class="accordion-heading"align="center">
                <a align="center"class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                  Таблица cилового баланс автомобиля (для  передачи)
                </a>
              </div>
              <div align="center"id="collapseOne" class="accordion-body collapse">
                <div align="center"lass="accordion-inner">
           <table align="center"class="table table-striped">
            <thead>
              <tr>
                <th><%= "№" %></th>

                 <th><%="Pk"%></th>
                 <th><%="Va"%></th>
              </tr>
            </thead>
<% for j in 1..5%>
      <% for i in 0..70 %>
                <%pk_n[i]=me[i]*uk[j]*@calculation.uo*@calculation.nu_t/rk %> 
               <%va_n[i]=ne[i]*rk/(uk[j]*@calculation.uo)%> 
               <tr>

               
       
                  <td> <%=i%></td>
                  <td> <%=pk_n[i]%></td>
                  <td><%=va_n[i]%></td>
                </tr>
      <%end%> 
     <br/>
      <%=pk_ne[j]=pk_n%> 
       <br/>
        <%=va_ne[j]=va_n%>
         <br/>
<%end%>
     </table>

        </div>
      </div>
  
  
  <%=pk_ne[1]%>
    <br/>
  <%=pk_ne[2]%>
   <br/>


   <%@vlabels= {
        0 => '0',
        21 => '100',
        51 => '200',
        71 => '300',
        91 => '400'
      } %>
<%g = Gruff::Line.new('800x700')%>


<%g.title = "Мощностной баланс авто" %>
<%g.title_font_size=25%>
  <% for j in 1..5%>
<%g.data("Pk(#{j})", pk_ne[j])%>
<%end%>
<%g.minimum_value = 0%>
<%g.labels = @vlabels%>
<%g.write('public/images/moshn_balance.png')%>
<br/>
<p align="center">
 <button align="center" type="button" class="btn btn-danger" data-toggle="collapse" data-target="#demo1">
    Скрыть/показать график
 </button>
     
    <div  align="center" id="demo1" class="collapse in"><br/> <img alt="Sample App" class="round" src="/images/moshn_balance.png" /></div>
</p>

<br/> 
  <br/>

  <%end%>
<%end%>
<div class="form-actions">
  <%= link_to t('.back', :default => t("Назад")),
              calculations_path, :class => 'btn'  %>
  <%= link_to t('.edit', :default => t("Редактирование")),
              edit_calculation_path(@calculation), :class => 'btn' %>
  <%= link_to t('.destroy', :default => t("Удаление")),
              calculation_path(@calculation),
              :method => 'delete',
              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              :class => 'btn btn-danger' %>
</div>
<% else %>
<div class="bs-docs-example">
            <div class="navbar">
              <div class="navbar-inner">
                <a class="brand" href="#">Расчет тягово-динамических характеристик автомобиля</a>
                <ul class="nav">
                  <li class="active"><a href="/">На главную</a></li>
                   <li><%= link_to "Создание расчета", new_calculation_path%></li>
                  <li><%= link_to "Список пользователей",users_index_path%></li>
                   <li><%= link_to "Список расчетов", calculations_path%></li>
                  <li  class="dropdown">
                   <button class="btn btn-small dropdown-toggle" data-toggle="dropdown">Доплнительно <span class="caret"></span></button>
                     <ul class="dropdown-menu">
                      <li><a href="#">Информация(скоро)</a></li>
                      <li><a href="#">Литература(скоро)</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </div>
Необходимо быть создателем расчета.
</br>
<%= link_to t('.back', :default => t("Назад")),
              calculations_path, :class => 'btn'  %>
<%end%>